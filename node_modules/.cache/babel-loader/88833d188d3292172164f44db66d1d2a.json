{"ast":null,"code":"import _slicedToArray from\"E:\\\\fcatcher-client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"E:\\\\fcatcher-client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"E:\\\\fcatcher-client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import axios from\"../../utils/axios\";import{createViewportAwareInputHandler,fillRect,Vector2}from\"gdxjs\";import createStartScreenSystem from\"./StartScreen\";import{checkPointInsideRect}from\"./utils/coordUtils\";import MurmurHash from\"imurmurhash\";import analytics from\"../../utils/analytics\";var MAGIC=\"blah@gamefox\";var getHeightBaseOnWidth=function getHeightBaseOnWidth(texture,textWidth){return[textWidth,textWidth*texture.height/texture.width];};var censorEmail=function censorEmail(email){if(email===undefined){return;}var tmp=email.split(\"@\");var nameLimitter=7;var domainLimitter=6;var lastChar=tmp[0].slice(-1);if(tmp[0].length>nameLimitter){tmp[0]=tmp[0].slice(0,nameLimitter);}if(email.length>13){if(tmp[1].length>domainLimitter){tmp[1]=tmp[1].slice(0,domainLimitter);tmp[1]+=\"..\";}}var numOfDisplay=Math.max(1,Math.floor(tmp[0].length/3));var resultString=\"\";for(var i=0;i<numOfDisplay;i++){resultString+=tmp[0].charAt(i);}return resultString+\"*\".repeat(tmp[0].length-2)+lastChar+\"@\"+tmp[1];};var createLeaderBoardSystem=function createLeaderBoardSystem(Game){var canvas=Game.canvas,viewport=Game.viewport,width=Game.width,height=Game.height,camera=Game.camera,batch=Game.batch,assets=Game.assets,score=Game.score,whiteTex=Game.whiteTex,font=Game.font;var goToStartScreen=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.t0=Game;_context.next=3;return createStartScreenSystem(Game);case 3:_context.t1=_context.sent;_context.t0.setCurrentScreen.call(_context.t0,_context.t1);case 5:case\"end\":return _context.stop();}}},_callee);}));return function goToStartScreen(){return _ref.apply(this,arguments);};}();var inputHandler=createViewportAwareInputHandler(canvas,viewport);var bg=assets.backGround;var atlas=assets.leaderBoard;var logo=atlas.findRegion(\"logo-2\",-1);var header=atlas.findRegion(\"header\",-1);var footer=atlas.findRegion(\"footer\",-1);var yourScore=atlas.findRegion(\"your-score\",-1);var no1=atlas.findRegion(\"no1\",-1);var no2=atlas.findRegion(\"no2\",-1);var retry=atlas.findRegion(\"thu-lai\",-1);var _getHeightBaseOnWidth=getHeightBaseOnWidth(logo,width/4.1),_getHeightBaseOnWidth2=_slicedToArray(_getHeightBaseOnWidth,2),LOGO_WIDTH=_getHeightBaseOnWidth2[0],LOGO_HEIGHT=_getHeightBaseOnWidth2[1];var _getHeightBaseOnWidth3=getHeightBaseOnWidth(header,width/2),_getHeightBaseOnWidth4=_slicedToArray(_getHeightBaseOnWidth3,2),HEADER_WIDTH=_getHeightBaseOnWidth4[0],HEADER_HEIGHT=_getHeightBaseOnWidth4[1];var _getHeightBaseOnWidth5=getHeightBaseOnWidth(footer,width*0.9),_getHeightBaseOnWidth6=_slicedToArray(_getHeightBaseOnWidth5,2),FOOTER_WIDTH=_getHeightBaseOnWidth6[0],FOOTER_HEIGHt=_getHeightBaseOnWidth6[1];var _getHeightBaseOnWidth7=getHeightBaseOnWidth(yourScore,width/2),_getHeightBaseOnWidth8=_slicedToArray(_getHeightBaseOnWidth7,2),S_WIDTH=_getHeightBaseOnWidth8[0],S_HIEGHT=_getHeightBaseOnWidth8[1];var _getHeightBaseOnWidth9=getHeightBaseOnWidth(no1,width/8),_getHeightBaseOnWidth10=_slicedToArray(_getHeightBaseOnWidth9,2),NO1_WIDTH=_getHeightBaseOnWidth10[0],NO1_HEIGHT=_getHeightBaseOnWidth10[1];var _getHeightBaseOnWidth11=getHeightBaseOnWidth(no2,width/8),_getHeightBaseOnWidth12=_slicedToArray(_getHeightBaseOnWidth11,2),NO2_WIDTH=_getHeightBaseOnWidth12[0],NO2_HEIGHT=_getHeightBaseOnWidth12[1];var _getHeightBaseOnWidth13=getHeightBaseOnWidth(retry,width/3),_getHeightBaseOnWidth14=_slicedToArray(_getHeightBaseOnWidth13,2),BUTTON_WIDTH=_getHeightBaseOnWidth14[0],BUTTON_HEIGHT=_getHeightBaseOnWidth14[1];var BUTTON_RECTS=[width/2-BUTTON_WIDTH/2,height*2.2/3,BUTTON_WIDTH,BUTTON_HEIGHT];var medalList=[{texture:no1,width:NO1_WIDTH,height:NO1_HEIGHT},{texture:no2,width:NO2_WIDTH,height:NO2_HEIGHT}];var CONTAINER_MARGIN=width/17;var CONTAINER_WIDTH=width-CONTAINER_MARGIN*2;var CONTAINER_HEIGHT=height-CONTAINER_MARGIN*2;var players=[];var getData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;analytics.track(\"gameOver\",{score:score});_context2.next=4;return axios.post(\"/leader-board\",{score:score,sig:MurmurHash().hash(\"\".concat(score,\";\").concat(MAGIC)).result()},{headers:{\"x-access-token\":localStorage.getItem(\"@Token\")}});case 4:res=_context2.sent;players=res.data;_context2.next=10;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);case 10:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return function getData(){return _ref2.apply(this,arguments);};}();getData();var coord=new Vector2();inputHandler.addEventListener(\"touchStart\",function(){coord.setVector(inputHandler.getTouchedWorldCoord());if(checkPointInsideRect(coord,BUTTON_RECTS)){Game.score=0;goToStartScreen();}});var numberFont=font.numberFont,textFont=font.textFont;var userScore=numberFont.setNewText(width);var scoreSize=width/5.3;var RESULT_START_X=width/3;var NAME_START_Y=height*0.62/3;var SCORE_START_Y=height*0.69/3;var userNameText=[textFont.setNewText(width),textFont.setNewText(width),textFont.setNewText(width)];var userScoreText=[numberFont.setNewText(width),numberFont.setNewText(width),numberFont.setNewText(width)];var userNameSize=width/14;var userScoreSize=width/10;var loopLength=0;// top 3 player ll be display\nvar gotData=false;var update=function update(delta){if(players.length>0&&!gotData){// console.log(players);\ngotData=true;for(var i=0;i<players.length;i++){players[i].email=censorEmail(players[i].email);players[i].username=players[i].username||\"\";players[i].username=players[i].username.length>12?players[i].username.slice(0,12)+\"..\":players[i].username;}}batch.setProjection(camera.combined);batch.begin();fillRect(batch,bg,0,0,width,height);batch.setColor(0,0,0,1);fillRect(batch,whiteTex,width/2-(CONTAINER_WIDTH+width/100)/2,height/2-(CONTAINER_HEIGHT+width/100)/2,CONTAINER_WIDTH+width/100,CONTAINER_HEIGHT+width/100);batch.setColor(255/255,246/255,234/255,1);fillRect(batch,whiteTex,width/2-CONTAINER_WIDTH/2,height/2-CONTAINER_HEIGHT/2,CONTAINER_WIDTH,CONTAINER_HEIGHT);batch.setColor(1,1,1,1);logo.draw(batch,width*1/12,height/50,LOGO_WIDTH,LOGO_HEIGHT);header.draw(batch,width*1.1/3,height/25,HEADER_WIDTH,HEADER_HEIGHT);yourScore.draw(batch,width/3,height*1.7/3,S_WIDTH,S_HIEGHT);batch.setColor(0,0,0,1);userScore.draw(batch,\"\".concat(Game.score),width/3,height*1.79/3,scoreSize);batch.setColor(1,1,1,1);retry.draw(batch,BUTTON_RECTS[0],BUTTON_RECTS[1],BUTTON_RECTS[2],BUTTON_RECTS[3]);footer.draw(batch,width/2-FOOTER_WIDTH/2,height-FOOTER_HEIGHt+height/200,FOOTER_WIDTH,FOOTER_HEIGHt);if(players.length>0){loopLength=players.length>3?3:players.length;for(var _i=0;_i<loopLength;_i++){batch.setColor(0,0,0,1);userNameText[_i].draw(batch,players[_i].username,RESULT_START_X,NAME_START_Y+_i*height/9,userNameSize);batch.setColor(255/255,115/255,23/255,1);userScoreText[_i].draw(batch,players[_i].score.toString(),RESULT_START_X,SCORE_START_Y+_i*height/9,userScoreSize);if(_i===0||_i===1){batch.setColor(1,1,1,1);medalList[_i].texture.draw(batch,width*0.55/3,height*0.6/3+height/8.6*_i,medalList[_i].width,medalList[_i].height);}}}batch.setColor(1,1,1,1);batch.end();};return{update:update,destroy:function destroy(){inputHandler.cleanup();}};};export default createLeaderBoardSystem;","map":{"version":3,"sources":["E:/fcatcher-client/src/components/game/LeaderBoardScreen.js"],"names":["axios","createViewportAwareInputHandler","fillRect","Vector2","createStartScreenSystem","checkPointInsideRect","MurmurHash","analytics","MAGIC","getHeightBaseOnWidth","texture","textWidth","height","width","censorEmail","email","undefined","tmp","split","nameLimitter","domainLimitter","lastChar","slice","length","numOfDisplay","Math","max","floor","resultString","i","charAt","repeat","createLeaderBoardSystem","Game","canvas","viewport","camera","batch","assets","score","whiteTex","font","goToStartScreen","setCurrentScreen","inputHandler","bg","backGround","atlas","leaderBoard","logo","findRegion","header","footer","yourScore","no1","no2","retry","LOGO_WIDTH","LOGO_HEIGHT","HEADER_WIDTH","HEADER_HEIGHT","FOOTER_WIDTH","FOOTER_HEIGHt","S_WIDTH","S_HIEGHT","NO1_WIDTH","NO1_HEIGHT","NO2_WIDTH","NO2_HEIGHT","BUTTON_WIDTH","BUTTON_HEIGHT","BUTTON_RECTS","medalList","CONTAINER_MARGIN","CONTAINER_WIDTH","CONTAINER_HEIGHT","players","getData","track","post","sig","hash","result","headers","localStorage","getItem","res","data","coord","addEventListener","setVector","getTouchedWorldCoord","numberFont","textFont","userScore","setNewText","scoreSize","RESULT_START_X","NAME_START_Y","SCORE_START_Y","userNameText","userScoreText","userNameSize","userScoreSize","loopLength","gotData","update","delta","username","setProjection","combined","begin","setColor","draw","toString","end","destroy","cleanup"],"mappings":"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","sourcesContent":["import axios from \"../../utils/axios\";\r\nimport { createViewportAwareInputHandler, fillRect, Vector2 } from \"gdxjs\";\r\nimport createStartScreenSystem from \"./StartScreen\";\r\nimport { checkPointInsideRect } from \"./utils/coordUtils\";\r\n\r\nimport MurmurHash from \"imurmurhash\";\r\nimport analytics from \"../../utils/analytics\";\r\n\r\nconst MAGIC = `blah@gamefox`;\r\n\r\nconst getHeightBaseOnWidth = (texture, textWidth) => {\r\n  return [textWidth, (textWidth * texture.height) / texture.width];\r\n};\r\n\r\nconst censorEmail = (email) => {\r\n  if (email === undefined) {\r\n    return;\r\n  }\r\n  let tmp = email.split(\"@\");\r\n  const nameLimitter = 7;\r\n  const domainLimitter = 6;\r\n  const lastChar = tmp[0].slice(-1);\r\n  if (tmp[0].length > nameLimitter) {\r\n    tmp[0] = tmp[0].slice(0, nameLimitter);\r\n  }\r\n\r\n  if (email.length > 13) {\r\n    if (tmp[1].length > domainLimitter) {\r\n      tmp[1] = tmp[1].slice(0, domainLimitter);\r\n      tmp[1] += \"..\";\r\n    }\r\n  }\r\n\r\n  let numOfDisplay = Math.max(1, Math.floor(tmp[0].length / 3));\r\n  let resultString = \"\";\r\n  for (let i = 0; i < numOfDisplay; i++) {\r\n    resultString += tmp[0].charAt(i);\r\n  }\r\n  return resultString + \"*\".repeat(tmp[0].length - 2) + lastChar + \"@\" + tmp[1];\r\n};\r\n\r\nconst createLeaderBoardSystem = (Game) => {\r\n  const {\r\n    canvas,\r\n    viewport,\r\n    width,\r\n    height,\r\n    camera,\r\n    batch,\r\n    assets,\r\n    score,\r\n    whiteTex,\r\n    font,\r\n  } = Game;\r\n\r\n  const goToStartScreen = async () => {\r\n    Game.setCurrentScreen(await createStartScreenSystem(Game));\r\n  };\r\n\r\n  const inputHandler = createViewportAwareInputHandler(canvas, viewport);\r\n\r\n  const bg = assets.backGround;\r\n  const atlas = assets.leaderBoard;\r\n  const logo = atlas.findRegion(\"logo-2\", -1);\r\n  const header = atlas.findRegion(\"header\", -1);\r\n  const footer = atlas.findRegion(\"footer\", -1);\r\n  const yourScore = atlas.findRegion(\"your-score\", -1);\r\n  const no1 = atlas.findRegion(\"no1\", -1);\r\n  const no2 = atlas.findRegion(\"no2\", -1);\r\n  const retry = atlas.findRegion(\"thu-lai\", -1);\r\n\r\n  const [LOGO_WIDTH, LOGO_HEIGHT] = getHeightBaseOnWidth(logo, width / 4.1);\r\n  const [HEADER_WIDTH, HEADER_HEIGHT] = getHeightBaseOnWidth(header, width / 2);\r\n  const [FOOTER_WIDTH, FOOTER_HEIGHt] = getHeightBaseOnWidth(\r\n    footer,\r\n    width * 0.9\r\n  );\r\n  const [S_WIDTH, S_HIEGHT] = getHeightBaseOnWidth(yourScore, width / 2);\r\n  const [NO1_WIDTH, NO1_HEIGHT] = getHeightBaseOnWidth(no1, width / 8);\r\n  const [NO2_WIDTH, NO2_HEIGHT] = getHeightBaseOnWidth(no2, width / 8);\r\n  const [BUTTON_WIDTH, BUTTON_HEIGHT] = getHeightBaseOnWidth(retry, width / 3);\r\n\r\n  const BUTTON_RECTS = [\r\n    width / 2 - BUTTON_WIDTH / 2,\r\n    (height * 2.2) / 3,\r\n    BUTTON_WIDTH,\r\n    BUTTON_HEIGHT,\r\n  ];\r\n\r\n  const medalList = [\r\n    { texture: no1, width: NO1_WIDTH, height: NO1_HEIGHT },\r\n    { texture: no2, width: NO2_WIDTH, height: NO2_HEIGHT },\r\n  ];\r\n\r\n  const CONTAINER_MARGIN = width / 17;\r\n  const CONTAINER_WIDTH = width - CONTAINER_MARGIN * 2;\r\n  const CONTAINER_HEIGHT = height - CONTAINER_MARGIN * 2;\r\n\r\n  let players = [];\r\n  const getData = async () => {\r\n    try {\r\n      analytics.track(\"gameOver\", { score });\r\n      const res = await axios.post(\r\n        \"/leader-board\",\r\n        { score, sig: MurmurHash().hash(`${score};${MAGIC}`).result() },\r\n        {\r\n          headers: { \"x-access-token\": localStorage.getItem(\"@Token\") },\r\n        }\r\n      );\r\n      players = res.data;\r\n    } catch (e) {}\r\n  };\r\n  getData();\r\n\r\n  let coord = new Vector2();\r\n  inputHandler.addEventListener(\"touchStart\", () => {\r\n    coord.setVector(inputHandler.getTouchedWorldCoord());\r\n    if (checkPointInsideRect(coord, BUTTON_RECTS)) {\r\n      Game.score = 0;\r\n      goToStartScreen();\r\n    }\r\n  });\r\n\r\n  const { numberFont, textFont } = font;\r\n  const userScore = numberFont.setNewText(width);\r\n  const scoreSize = width / 5.3;\r\n\r\n  const RESULT_START_X = width / 3;\r\n  const NAME_START_Y = (height * 0.62) / 3;\r\n  const SCORE_START_Y = (height * 0.69) / 3;\r\n\r\n  const userNameText = [\r\n    textFont.setNewText(width),\r\n    textFont.setNewText(width),\r\n    textFont.setNewText(width),\r\n  ];\r\n  const userScoreText = [\r\n    numberFont.setNewText(width),\r\n    numberFont.setNewText(width),\r\n    numberFont.setNewText(width),\r\n  ];\r\n  const userNameSize = width / 14;\r\n  const userScoreSize = width / 10;\r\n  let loopLength = 0; // top 3 player ll be display\r\n\r\n  let gotData = false;\r\n  const update = (delta) => {\r\n    if (players.length > 0 && !gotData) {\r\n      // console.log(players);\r\n      gotData = true;\r\n      for (let i = 0; i < players.length; i++) {\r\n        players[i].email = censorEmail(players[i].email);\r\n        players[i].username = players[i].username || \"\";\r\n        players[i].username =\r\n          players[i].username.length > 12\r\n            ? players[i].username.slice(0, 12) + \"..\"\r\n            : players[i].username;\r\n      }\r\n    }\r\n\r\n    batch.setProjection(camera.combined);\r\n    batch.begin();\r\n    fillRect(batch, bg, 0, 0, width, height);\r\n    batch.setColor(0, 0, 0, 1);\r\n    fillRect(\r\n      batch,\r\n      whiteTex,\r\n      width / 2 - (CONTAINER_WIDTH + width / 100) / 2,\r\n      height / 2 - (CONTAINER_HEIGHT + width / 100) / 2,\r\n      CONTAINER_WIDTH + width / 100,\r\n      CONTAINER_HEIGHT + width / 100\r\n    );\r\n    batch.setColor(255 / 255, 246 / 255, 234 / 255, 1);\r\n    fillRect(\r\n      batch,\r\n      whiteTex,\r\n      width / 2 - CONTAINER_WIDTH / 2,\r\n      height / 2 - CONTAINER_HEIGHT / 2,\r\n      CONTAINER_WIDTH,\r\n      CONTAINER_HEIGHT\r\n    );\r\n    batch.setColor(1, 1, 1, 1);\r\n    logo.draw(batch, (width * 1) / 12, height / 50, LOGO_WIDTH, LOGO_HEIGHT);\r\n    header.draw(\r\n      batch,\r\n      (width * 1.1) / 3,\r\n      height / 25,\r\n      HEADER_WIDTH,\r\n      HEADER_HEIGHT\r\n    );\r\n    yourScore.draw(batch, width / 3, (height * 1.7) / 3, S_WIDTH, S_HIEGHT);\r\n    batch.setColor(0, 0, 0, 1);\r\n    userScore.draw(\r\n      batch,\r\n      `${Game.score}`,\r\n      width / 3,\r\n      (height * 1.79) / 3,\r\n      scoreSize\r\n    );\r\n    batch.setColor(1, 1, 1, 1);\r\n    retry.draw(\r\n      batch,\r\n      BUTTON_RECTS[0],\r\n      BUTTON_RECTS[1],\r\n      BUTTON_RECTS[2],\r\n      BUTTON_RECTS[3]\r\n    );\r\n    footer.draw(\r\n      batch,\r\n      width / 2 - FOOTER_WIDTH / 2,\r\n      height - FOOTER_HEIGHt + height / 200,\r\n      FOOTER_WIDTH,\r\n      FOOTER_HEIGHt\r\n    );\r\n    if (players.length > 0) {\r\n      loopLength = players.length > 3 ? 3 : players.length;\r\n      for (let i = 0; i < loopLength; i++) {\r\n        batch.setColor(0, 0, 0, 1);\r\n        userNameText[i].draw(\r\n          batch,\r\n          players[i].username,\r\n          RESULT_START_X,\r\n          NAME_START_Y + (i * height) / 9,\r\n          userNameSize\r\n        );\r\n        batch.setColor(255 / 255, 115 / 255, 23 / 255, 1);\r\n        userScoreText[i].draw(\r\n          batch,\r\n          players[i].score.toString(),\r\n          RESULT_START_X,\r\n          SCORE_START_Y + (i * height) / 9,\r\n          userScoreSize\r\n        );\r\n        if (i === 0 || i === 1) {\r\n          batch.setColor(1, 1, 1, 1);\r\n          medalList[i].texture.draw(\r\n            batch,\r\n            (width * 0.55) / 3,\r\n            (height * 0.6) / 3 + (height / 8.6) * i,\r\n            medalList[i].width,\r\n            medalList[i].height\r\n          );\r\n        }\r\n      }\r\n    }\r\n    batch.setColor(1, 1, 1, 1);\r\n\r\n    batch.end();\r\n  };\r\n  return {\r\n    update,\r\n    destroy() {\r\n      inputHandler.cleanup();\r\n    },\r\n  };\r\n};\r\nexport default createLeaderBoardSystem;\r\n"]},"metadata":{},"sourceType":"module"}