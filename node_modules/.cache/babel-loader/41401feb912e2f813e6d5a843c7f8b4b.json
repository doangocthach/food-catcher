{"ast":null,"code":"import axios from \"../../utils/axios\";\nimport { createViewportAwareInputHandler, fillRect, Vector2 } from \"gdxjs\";\nimport createStartScreenSystem from \"./StartScreen\";\nimport { checkPointInsideRect } from \"./utils/coordUtils\";\n\nconst getHeightBaseOnWidth = (texture, textWidth) => {\n  return [textWidth, textWidth * texture.height / texture.width];\n};\n\nvar censorWord = function (str) {\n  return str[0] + \"*\".repeat(str.length - 2) + str.slice(-1);\n};\n\nvar censorEmail2 = function (email) {\n  var arr = email.split(\"@\");\n  return censorWord(arr[0]) + \"@\" + censorWord(arr[1]);\n};\n\nconst censorEmail = email => {\n  let tmp = email.split(\"@\");\n  const lastChar = tmp[0].slice(-1);\n\n  if (tmp[0].length > 5) {\n    tmp[0] = tmp[0].slice(0, 5);\n  }\n\n  if (tmp[1].length > 5) {\n    tmp[1] = tmp[1].slice(0, 5);\n    tmp[1] += \"..\";\n  }\n\n  let numOfDisplay = Math.max(1, Math.floor(tmp[0].length / 2));\n  let resultString = \"\"; // console.log(tmp[0].charAt(0));\n\n  for (let i = 0; i < numOfDisplay; i++) {\n    resultString += tmp[0].charAt(i);\n  }\n\n  return resultString + \"*\".repeat(tmp[0].length - 2) + lastChar + \"@\" + tmp[1];\n};\n\nconst createLeaderBoardSystem = Game => {\n  const email = \"dcmcvclsclmc@gmail.com\";\n  const censoredEmail = censorEmail(email);\n  console.log(censoredEmail);\n  const {\n    canvas,\n    viewport,\n    width,\n    height,\n    camera,\n    batch,\n    assets,\n    score,\n    whiteTex,\n    font\n  } = Game;\n\n  const goToStartScreen = async () => {\n    Game.setCurrentScreen(await createStartScreenSystem(Game));\n  };\n\n  const inputHandler = createViewportAwareInputHandler(canvas, viewport);\n  const bg = assets.backGround;\n  const atlas = assets.leaderBoard;\n  const logo = atlas.findRegion(\"logo-2\", -1);\n  const header = atlas.findRegion(\"header\", -1);\n  const footer = atlas.findRegion(\"footer\", -1);\n  const yourScore = atlas.findRegion(\"your-score\", -1);\n  const no1 = atlas.findRegion(\"no1\", -1);\n  const no2 = atlas.findRegion(\"no2\", -1);\n  const retry = atlas.findRegion(\"thu-lai\", -1);\n  const [LOGO_WIDTH, LOGO_HEIGHT] = getHeightBaseOnWidth(logo, width / 4.1);\n  const [HEADER_WIDTH, HEADER_HEIGHT] = getHeightBaseOnWidth(header, width / 2);\n  const [FOOTER_WIDTH, FOOTER_HEIGHt] = getHeightBaseOnWidth(footer, width * 0.9);\n  const [S_WIDTH, S_HIEGHT] = getHeightBaseOnWidth(yourScore, width / 2);\n  const [NO1_WIDTH, NO1_HEIGHT] = getHeightBaseOnWidth(no1, width / 8);\n  const [NO2_WIDTH, NO2_HEIGHT] = getHeightBaseOnWidth(no2, width / 8);\n  const [BUTTON_WIDTH, BUTTON_HEIGHT] = getHeightBaseOnWidth(retry, width / 3);\n  const BUTTON_RECTS = [width / 2 - BUTTON_WIDTH / 2, height * 2.2 / 3, BUTTON_WIDTH, BUTTON_HEIGHT];\n  const medalList = [{\n    texture: no1,\n    width: NO1_WIDTH,\n    height: NO1_HEIGHT\n  }, {\n    texture: no2,\n    width: NO2_WIDTH,\n    height: NO2_HEIGHT\n  }];\n  const CONTAINER_MARGIN = width / 17;\n  const CONTAINER_WIDTH = width - CONTAINER_MARGIN * 2;\n  const CONTAINER_HEIGHT = height - CONTAINER_MARGIN * 2;\n  let players = [];\n\n  const getData = async () => {\n    try {\n      const res = await axios.post(\"/leader-board\", {\n        score\n      }, {\n        headers: {\n          \"x-access-token\": localStorage.getItem(\"@Token\")\n        }\n      });\n      players = res.data;\n    } catch (e) {}\n  };\n\n  getData();\n  let coord = new Vector2();\n  inputHandler.addEventListener(\"touchStart\", () => {\n    coord.setVector(inputHandler.getTouchedWorldCoord());\n\n    if (checkPointInsideRect(coord, BUTTON_RECTS)) {\n      Game.score = 0;\n      goToStartScreen();\n    }\n  });\n  const {\n    numberFont,\n    textFont\n  } = font;\n  const userScore = numberFont.setNewText(width);\n  const scoreSize = width / 5.3;\n  const RESULT_START_X = width / 3;\n  const NAME_START_Y = height * 0.6 / 3;\n  const SCORE_START_Y = height * 0.69 / 3;\n  const userNameText = [textFont.setNewText(width), textFont.setNewText(width), textFont.setNewText(width)];\n  const userScoreText = [numberFont.setNewText(width), numberFont.setNewText(width), numberFont.setNewText(width)];\n  const userNameSize = width / 11;\n  const userScoreSize = width / 8;\n  let loopLength = 0; // top 3 player ll be display\n\n  const update = delta => {\n    batch.setProjection(camera.combined);\n    batch.begin();\n    fillRect(batch, bg, 0, 0, width, height);\n    batch.setColor(0, 0, 0, 1);\n    fillRect(batch, whiteTex, width / 2 - (CONTAINER_WIDTH + width / 100) / 2, height / 2 - (CONTAINER_HEIGHT + width / 100) / 2, CONTAINER_WIDTH + width / 100, CONTAINER_HEIGHT + width / 100);\n    batch.setColor(255 / 255, 246 / 255, 234 / 255, 1);\n    fillRect(batch, whiteTex, width / 2 - CONTAINER_WIDTH / 2, height / 2 - CONTAINER_HEIGHT / 2, CONTAINER_WIDTH, CONTAINER_HEIGHT);\n    batch.setColor(1, 1, 1, 1);\n    logo.draw(batch, width * 1 / 12, height / 50, LOGO_WIDTH, LOGO_HEIGHT);\n    header.draw(batch, width * 1.1 / 3, height / 25, HEADER_WIDTH, HEADER_HEIGHT);\n    yourScore.draw(batch, width / 3, height * 1.7 / 3, S_WIDTH, S_HIEGHT);\n    batch.setColor(0, 0, 0, 1);\n    userScore.draw(batch, `${Game.score}`, width / 3, height * 1.79 / 3, scoreSize);\n    batch.setColor(1, 1, 1, 1);\n    retry.draw(batch, BUTTON_RECTS[0], BUTTON_RECTS[1], BUTTON_RECTS[2], BUTTON_RECTS[3]);\n    footer.draw(batch, width / 2 - FOOTER_WIDTH / 2, height - FOOTER_HEIGHt + height / 200, FOOTER_WIDTH, FOOTER_HEIGHt);\n\n    if (players.length > 0) {\n      loopLength = players.length > 3 ? 3 : players.length;\n\n      for (let i = 0; i < loopLength; i++) {\n        batch.setColor(0, 0, 0, 1);\n        userNameText[i].draw(batch, players[i].email, RESULT_START_X, NAME_START_Y + i * height / 9, userNameSize);\n        batch.setColor(255 / 255, 115 / 255, 23 / 255, 1);\n        userScoreText[i].draw(batch, players[i].score.toString(), RESULT_START_X, SCORE_START_Y + i * height / 9, userScoreSize);\n\n        if (i === 0 || i == 1) {\n          batch.setColor(1, 1, 1, 1);\n          medalList[i].texture.draw(batch, width * 0.55 / 3, height * 0.6 / 3 + height / 8.6 * i, medalList[i].width, medalList[i].height);\n        }\n      }\n    }\n\n    batch.setColor(1, 1, 1, 1);\n    batch.end();\n  };\n\n  return {\n    update,\n\n    destroy() {\n      inputHandler.cleanup();\n    }\n\n  };\n};\n\nexport default createLeaderBoardSystem;","map":{"version":3,"sources":["E:/fcatcher-client/src/components/game/LeaderBoardScreen.js"],"names":["axios","createViewportAwareInputHandler","fillRect","Vector2","createStartScreenSystem","checkPointInsideRect","getHeightBaseOnWidth","texture","textWidth","height","width","censorWord","str","repeat","length","slice","censorEmail2","email","arr","split","censorEmail","tmp","lastChar","numOfDisplay","Math","max","floor","resultString","i","charAt","createLeaderBoardSystem","Game","censoredEmail","console","log","canvas","viewport","camera","batch","assets","score","whiteTex","font","goToStartScreen","setCurrentScreen","inputHandler","bg","backGround","atlas","leaderBoard","logo","findRegion","header","footer","yourScore","no1","no2","retry","LOGO_WIDTH","LOGO_HEIGHT","HEADER_WIDTH","HEADER_HEIGHT","FOOTER_WIDTH","FOOTER_HEIGHt","S_WIDTH","S_HIEGHT","NO1_WIDTH","NO1_HEIGHT","NO2_WIDTH","NO2_HEIGHT","BUTTON_WIDTH","BUTTON_HEIGHT","BUTTON_RECTS","medalList","CONTAINER_MARGIN","CONTAINER_WIDTH","CONTAINER_HEIGHT","players","getData","res","post","headers","localStorage","getItem","data","e","coord","addEventListener","setVector","getTouchedWorldCoord","numberFont","textFont","userScore","setNewText","scoreSize","RESULT_START_X","NAME_START_Y","SCORE_START_Y","userNameText","userScoreText","userNameSize","userScoreSize","loopLength","update","delta","setProjection","combined","begin","setColor","draw","toString","end","destroy","cleanup"],"mappings":"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","sourcesContent":["import axios from \"../../utils/axios\";\r\nimport { createViewportAwareInputHandler, fillRect, Vector2 } from \"gdxjs\";\r\nimport createStartScreenSystem from \"./StartScreen\";\r\nimport { checkPointInsideRect } from \"./utils/coordUtils\";\r\n\r\nconst getHeightBaseOnWidth = (texture, textWidth) => {\r\n  return [textWidth, (textWidth * texture.height) / texture.width];\r\n};\r\n\r\nvar censorWord = function (str) {\r\n  return str[0] + \"*\".repeat(str.length - 2) + str.slice(-1);\r\n};\r\n\r\nvar censorEmail2 = function (email) {\r\n  var arr = email.split(\"@\");\r\n  return censorWord(arr[0]) + \"@\" + censorWord(arr[1]);\r\n};\r\n\r\nconst censorEmail = (email) => {\r\n  let tmp = email.split(\"@\");\r\n  const lastChar = tmp[0].slice(-1);\r\n  if (tmp[0].length > 5) {\r\n    tmp[0] = tmp[0].slice(0, 5);\r\n  }\r\n  if (tmp[1].length > 5) {\r\n    tmp[1] = tmp[1].slice(0, 5);\r\n    tmp[1] += \"..\";\r\n  }\r\n\r\n  let numOfDisplay = Math.max(1, Math.floor(tmp[0].length / 2));\r\n  let resultString = \"\";\r\n  // console.log(tmp[0].charAt(0));\r\n  for (let i = 0; i < numOfDisplay; i++) {\r\n    resultString += tmp[0].charAt(i);\r\n  }\r\n  return resultString + \"*\".repeat(tmp[0].length - 2) + lastChar + \"@\" + tmp[1];\r\n};\r\n\r\nconst createLeaderBoardSystem = (Game) => {\r\n  const email = \"dcmcvclsclmc@gmail.com\";\r\n  const censoredEmail = censorEmail(email);\r\n  console.log(censoredEmail);\r\n\r\n  const {\r\n    canvas,\r\n    viewport,\r\n    width,\r\n    height,\r\n    camera,\r\n    batch,\r\n    assets,\r\n    score,\r\n    whiteTex,\r\n    font,\r\n  } = Game;\r\n\r\n  const goToStartScreen = async () => {\r\n    Game.setCurrentScreen(await createStartScreenSystem(Game));\r\n  };\r\n\r\n  const inputHandler = createViewportAwareInputHandler(canvas, viewport);\r\n\r\n  const bg = assets.backGround;\r\n  const atlas = assets.leaderBoard;\r\n  const logo = atlas.findRegion(\"logo-2\", -1);\r\n  const header = atlas.findRegion(\"header\", -1);\r\n  const footer = atlas.findRegion(\"footer\", -1);\r\n  const yourScore = atlas.findRegion(\"your-score\", -1);\r\n  const no1 = atlas.findRegion(\"no1\", -1);\r\n  const no2 = atlas.findRegion(\"no2\", -1);\r\n  const retry = atlas.findRegion(\"thu-lai\", -1);\r\n\r\n  const [LOGO_WIDTH, LOGO_HEIGHT] = getHeightBaseOnWidth(logo, width / 4.1);\r\n  const [HEADER_WIDTH, HEADER_HEIGHT] = getHeightBaseOnWidth(header, width / 2);\r\n  const [FOOTER_WIDTH, FOOTER_HEIGHt] = getHeightBaseOnWidth(\r\n    footer,\r\n    width * 0.9\r\n  );\r\n  const [S_WIDTH, S_HIEGHT] = getHeightBaseOnWidth(yourScore, width / 2);\r\n  const [NO1_WIDTH, NO1_HEIGHT] = getHeightBaseOnWidth(no1, width / 8);\r\n  const [NO2_WIDTH, NO2_HEIGHT] = getHeightBaseOnWidth(no2, width / 8);\r\n  const [BUTTON_WIDTH, BUTTON_HEIGHT] = getHeightBaseOnWidth(retry, width / 3);\r\n\r\n  const BUTTON_RECTS = [\r\n    width / 2 - BUTTON_WIDTH / 2,\r\n    (height * 2.2) / 3,\r\n    BUTTON_WIDTH,\r\n    BUTTON_HEIGHT,\r\n  ];\r\n\r\n  const medalList = [\r\n    { texture: no1, width: NO1_WIDTH, height: NO1_HEIGHT },\r\n    { texture: no2, width: NO2_WIDTH, height: NO2_HEIGHT },\r\n  ];\r\n\r\n  const CONTAINER_MARGIN = width / 17;\r\n  const CONTAINER_WIDTH = width - CONTAINER_MARGIN * 2;\r\n  const CONTAINER_HEIGHT = height - CONTAINER_MARGIN * 2;\r\n\r\n  let players = [];\r\n  const getData = async () => {\r\n    try {\r\n      const res = await axios.post(\r\n        \"/leader-board\",\r\n        { score },\r\n        {\r\n          headers: { \"x-access-token\": localStorage.getItem(\"@Token\") },\r\n        }\r\n      );\r\n      players = res.data;\r\n    } catch (e) {}\r\n  };\r\n  getData();\r\n\r\n  let coord = new Vector2();\r\n  inputHandler.addEventListener(\"touchStart\", () => {\r\n    coord.setVector(inputHandler.getTouchedWorldCoord());\r\n    if (checkPointInsideRect(coord, BUTTON_RECTS)) {\r\n      Game.score = 0;\r\n      goToStartScreen();\r\n    }\r\n  });\r\n\r\n  const { numberFont, textFont } = font;\r\n  const userScore = numberFont.setNewText(width);\r\n  const scoreSize = width / 5.3;\r\n\r\n  const RESULT_START_X = width / 3;\r\n  const NAME_START_Y = (height * 0.6) / 3;\r\n  const SCORE_START_Y = (height * 0.69) / 3;\r\n\r\n  const userNameText = [\r\n    textFont.setNewText(width),\r\n    textFont.setNewText(width),\r\n    textFont.setNewText(width),\r\n  ];\r\n  const userScoreText = [\r\n    numberFont.setNewText(width),\r\n    numberFont.setNewText(width),\r\n    numberFont.setNewText(width),\r\n  ];\r\n  const userNameSize = width / 11;\r\n  const userScoreSize = width / 8;\r\n  let loopLength = 0; // top 3 player ll be display\r\n\r\n  const update = (delta) => {\r\n    batch.setProjection(camera.combined);\r\n    batch.begin();\r\n    fillRect(batch, bg, 0, 0, width, height);\r\n    batch.setColor(0, 0, 0, 1);\r\n    fillRect(\r\n      batch,\r\n      whiteTex,\r\n      width / 2 - (CONTAINER_WIDTH + width / 100) / 2,\r\n      height / 2 - (CONTAINER_HEIGHT + width / 100) / 2,\r\n      CONTAINER_WIDTH + width / 100,\r\n      CONTAINER_HEIGHT + width / 100\r\n    );\r\n    batch.setColor(255 / 255, 246 / 255, 234 / 255, 1);\r\n    fillRect(\r\n      batch,\r\n      whiteTex,\r\n      width / 2 - CONTAINER_WIDTH / 2,\r\n      height / 2 - CONTAINER_HEIGHT / 2,\r\n      CONTAINER_WIDTH,\r\n      CONTAINER_HEIGHT\r\n    );\r\n    batch.setColor(1, 1, 1, 1);\r\n    logo.draw(batch, (width * 1) / 12, height / 50, LOGO_WIDTH, LOGO_HEIGHT);\r\n    header.draw(\r\n      batch,\r\n      (width * 1.1) / 3,\r\n      height / 25,\r\n      HEADER_WIDTH,\r\n      HEADER_HEIGHT\r\n    );\r\n    yourScore.draw(batch, width / 3, (height * 1.7) / 3, S_WIDTH, S_HIEGHT);\r\n    batch.setColor(0, 0, 0, 1);\r\n    userScore.draw(\r\n      batch,\r\n      `${Game.score}`,\r\n      width / 3,\r\n      (height * 1.79) / 3,\r\n      scoreSize\r\n    );\r\n    batch.setColor(1, 1, 1, 1);\r\n    retry.draw(\r\n      batch,\r\n      BUTTON_RECTS[0],\r\n      BUTTON_RECTS[1],\r\n      BUTTON_RECTS[2],\r\n      BUTTON_RECTS[3]\r\n    );\r\n    footer.draw(\r\n      batch,\r\n      width / 2 - FOOTER_WIDTH / 2,\r\n      height - FOOTER_HEIGHt + height / 200,\r\n      FOOTER_WIDTH,\r\n      FOOTER_HEIGHt\r\n    );\r\n    if (players.length > 0) {\r\n      loopLength = players.length > 3 ? 3 : players.length;\r\n      for (let i = 0; i < loopLength; i++) {\r\n        batch.setColor(0, 0, 0, 1);\r\n        userNameText[i].draw(\r\n          batch,\r\n          players[i].email,\r\n          RESULT_START_X,\r\n          NAME_START_Y + (i * height) / 9,\r\n          userNameSize\r\n        );\r\n        batch.setColor(255 / 255, 115 / 255, 23 / 255, 1);\r\n        userScoreText[i].draw(\r\n          batch,\r\n          players[i].score.toString(),\r\n          RESULT_START_X,\r\n          SCORE_START_Y + (i * height) / 9,\r\n          userScoreSize\r\n        );\r\n        if (i === 0 || i == 1) {\r\n          batch.setColor(1, 1, 1, 1);\r\n          medalList[i].texture.draw(\r\n            batch,\r\n            (width * 0.55) / 3,\r\n            (height * 0.6) / 3 + (height / 8.6) * i,\r\n            medalList[i].width,\r\n            medalList[i].height\r\n          );\r\n        }\r\n      }\r\n    }\r\n    batch.setColor(1, 1, 1, 1);\r\n\r\n    batch.end();\r\n  };\r\n  return {\r\n    update,\r\n    destroy() {\r\n      inputHandler.cleanup();\r\n    },\r\n  };\r\n};\r\nexport default createLeaderBoardSystem;\r\n"]},"metadata":{},"sourceType":"module"}