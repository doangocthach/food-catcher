{"ast":null,"code":"import _createForOfIteratorHelper from\"E:\\\\fcatcher-client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createForOfIteratorHelper\";var shuffle=function shuffle(array){array.sort(function(){return Math.random()-0.5;});};var randomArray,tmp,tmp2,otherFoodArray;var getRandomFoodList=function getRandomFoodList(foodTex,recipes,comboCounter,difficulty){randomArray=[];tmp=[];tmp2=[];otherFoodArray=[];var _iterator=_createForOfIteratorHelper(recipes),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var rep=_step.value;randomArray.push(rep.type);tmp.push(rep.type);}}catch(err){_iterator.e(err);}finally{_iterator.f();}for(var i=0;i<foodTex.length;i++){tmp2.push(foodTex[i].index);}var _iterator2=_createForOfIteratorHelper(tmp2),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var value=_step2.value;if(!tmp.includes(value)){otherFoodArray.push(value);}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}if(comboCounter>=5&&comboCounter<10){randomArray.push(otherFoodArray[0]);}if(comboCounter>=10&&comboCounter<20){for(var _i=0;_i<otherFoodArray.length-1;_i++){randomArray.push(otherFoodArray[_i]);}}if(comboCounter>=20){for(var _i2=0;_i2<otherFoodArray.length;_i2++){randomArray.push(otherFoodArray[_i2]);}}return randomArray;};var getDelayBaseOnDifficulty=function getDelayBaseOnDifficulty(difficulty){if(difficulty>=1&&difficulty<=3){return 2.5;}else if(difficulty>=4&&difficulty<=6){return 2;}else if(difficulty>=7&&difficulty<=9){return 1.5;}else{return 1;}};var getPattern=function getPattern(number,width,height){var timer;var upSpeedX=[];var upSpeedY;var upAccelerationY;var time;var tmpSpeedX=[];var tmpAccX=[];if(number===0){// 3 on 1 line\ntimer=[0,0.15,0.2];upSpeedY=[height/2];upAccelerationY=-height/4;time=-upSpeedY/upAccelerationY;if(Math.random()>0.5){tmpSpeedX=[width/3];}else{tmpSpeedX=[-width/3];}}else if(number===3){// 4 zig zag\ntimer=[0,0.15,0.17,0.25];upSpeedY=[height/2];upAccelerationY=-height/4;time=-upSpeedY/upAccelerationY;if(Math.random()>0.5){tmpSpeedX=[width/3,width/10,-width/10,-width/3];}else{tmpSpeedX=[-width/3,-width/10,width/10,width/3];}}else if(number===4){// 5 V\ntimer=[0,0.16,0.16,0.17,0.17];upSpeedY=[height/2.1];upAccelerationY=-height/4;time=-upSpeedY/upAccelerationY;tmpSpeedX=[width/100,width/6,-width/6,width/2.5,-width/2.5];}else if(number===5){// 5 V reverse\ntimer=[0,0,0.12,0.12,0.2];upSpeedY=[height/2.1];upAccelerationY=-height/4;time=-upSpeedY/upAccelerationY;tmpSpeedX=[width/2.5,-width/2.5,width/6,-width/6,width/100];}else if(number===1){// 2 random index same time\ntimer=[0,0.15];upSpeedY=[height/2];upAccelerationY=-height/4;time=-upSpeedY/upAccelerationY;if(Math.random()>0.5){tmpSpeedX=[Math.random()*(width/4-width/8)+width/8,-(Math.random()*(width/4-width/8)+width/8)];}else{tmpSpeedX=[-(Math.random()*(width/4-width/8)+width/8),Math.random()*(width/4-width/8)+width/8];}}else if(number===2){// 3 random index same time\ntimer=[0,0.2,0.1];upSpeedY=[height/2];upAccelerationY=-height/4;time=-upSpeedY/upAccelerationY;tmpSpeedX=[Math.random()*(width/4-width/6)+width/6,-(Math.random()*(width/2.8-width/5.5)+width/5.5),Math.random()*(width/20-width/40)+width/40];}for(var i=0;i<tmpSpeedX.length;i++){tmpAccX.push(-tmpSpeedX[i]/time);}for(var _i3=0;_i3<tmpSpeedX.length;_i3++){upSpeedX.push({speedX:tmpSpeedX[_i3],accerX:tmpAccX[_i3]});}return{timer:timer,upSpeedX:upSpeedX,upSpeedY:upSpeedY,upAccelerationY:upAccelerationY,time:time};};var getShootTypeBaseOnDifficulty=function getShootTypeBaseOnDifficulty(difficulty){if(difficulty>=1&&difficulty<=2){return{minNumber:0,maxNumber:2};}else if(difficulty>=3&&difficulty<=7){return{minNumber:0,maxNumber:3};}else{return{minNumber:0,maxNumber:5};}};var createFoodSpawnSystem=function createFoodSpawnSystem(){var index=0;var delayAfterCombo=2;var pattern;var timer;var speedXIndex=0;var speedYIndex=0;return{init:function init(worldState,extra){},update:function update(delta,worldState,_ref){var width=_ref.width,height=_ref.height;// console.log(worldState.foods);\n// console.log(worldState.stateTime, delayAfterCombo, timer);\nvar foodTex=worldState.foodTex,difficulty=worldState.difficulty,recipes=worldState.recipes,comboCounter=worldState.comboCounter;if(pattern===undefined&&worldState.stateTime>delayAfterCombo){var _getShootTypeBaseOnDi=getShootTypeBaseOnDifficulty(difficulty),minNumber=_getShootTypeBaseOnDi.minNumber,maxNumber=_getShootTypeBaseOnDi.maxNumber;pattern=getPattern(Math.round(Math.random()*(maxNumber-minNumber)+minNumber),width,height);// pattern = getPattern(5, width, height);\ntimer=worldState.stateTime+pattern.timer[index];}else if(worldState.stateTime>delayAfterCombo&&worldState.stateTime>timer){index=Math.min(index+=1,pattern.timer.length);timer=worldState.stateTime+pattern.timer[index];var loop=1;var tmpIndex=index-1;while(true){if(pattern.timer[tmpIndex]===pattern.timer[tmpIndex+1]&&tmpIndex<pattern.timer.length){tmpIndex=Math.min(tmpIndex+=1,pattern.timer.length);loop+=1;}else{break;}}// console.log(loop, index);\nfor(var i=0;i<loop;i++){if(i>0){index=Math.min(index+=1,pattern.timer.length);}timer=worldState.stateTime+pattern.timer[index];var randomFoodArray=getRandomFoodList(foodTex,recipes,comboCounter,difficulty);shuffle(randomFoodArray);worldState.foods.push({stateTime:0,type:randomFoodArray[0],x:width/2,y:height*2/3,upTime:worldState.stateTime+pattern.time,// check with game stateTime\nupRealTime:pattern.time,oriSpeedX:pattern.upSpeedX[speedXIndex].speedX,oriSpeedY:pattern.upSpeedY[speedYIndex],upSpeedX:pattern.upSpeedX[speedXIndex].speedX,upSpeedY:pattern.upSpeedY[speedYIndex],upAccelerationX:pattern.upSpeedX[speedXIndex].accerX,upAccelerationY:pattern.upAccelerationY,downSpeedY:0,downAcceleration:height/100,scaleSpeed:(1-0)/pattern.time,opacitySpeed:(1-0)/pattern.time,oriScale:0,oriOpacity:0});speedXIndex=Math.min(speedXIndex+=1,pattern.upSpeedX.length-1);speedYIndex=Math.min(speedYIndex+=1,pattern.upSpeedY.length-1);}// last\nif(index===pattern.timer.length){delayAfterCombo=worldState.stateTime+getDelayBaseOnDifficulty(difficulty);index=0;speedXIndex=0;speedYIndex=0;pattern=undefined;}}}};};export default createFoodSpawnSystem;","map":{"version":3,"sources":["E:/fcatcher-client/src/components/game/systems/FoodSpawnSystem.js"],"names":["shuffle","array","sort","Math","random","randomArray","tmp","tmp2","otherFoodArray","getRandomFoodList","foodTex","recipes","comboCounter","difficulty","rep","push","type","i","length","index","value","includes","getDelayBaseOnDifficulty","getPattern","number","width","height","timer","upSpeedX","upSpeedY","upAccelerationY","time","tmpSpeedX","tmpAccX","speedX","accerX","getShootTypeBaseOnDifficulty","minNumber","maxNumber","createFoodSpawnSystem","delayAfterCombo","pattern","speedXIndex","speedYIndex","init","worldState","extra","update","delta","undefined","stateTime","round","min","loop","tmpIndex","randomFoodArray","foods","x","y","upTime","upRealTime","oriSpeedX","oriSpeedY","upAccelerationX","downSpeedY","downAcceleration","scaleSpeed","opacitySpeed","oriScale","oriOpacity"],"mappings":"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","sourcesContent":["const shuffle = (array) => {\r\n  array.sort(() => Math.random() - 0.5);\r\n};\r\n\r\nlet randomArray, tmp, tmp2, otherFoodArray;\r\nconst getRandomFoodList = (foodTex, recipes, comboCounter, difficulty) => {\r\n  randomArray = [];\r\n  tmp = [];\r\n  tmp2 = [];\r\n  otherFoodArray = [];\r\n\r\n  for (let rep of recipes) {\r\n    randomArray.push(rep.type);\r\n    tmp.push(rep.type);\r\n  }\r\n\r\n  for (let i = 0; i < foodTex.length; i++) {\r\n    tmp2.push(foodTex[i].index);\r\n  }\r\n\r\n  for (let value of tmp2) {\r\n    if (!tmp.includes(value)) {\r\n      otherFoodArray.push(value);\r\n    }\r\n  }\r\n  if (comboCounter >= 5 && comboCounter < 10) {\r\n    randomArray.push(otherFoodArray[0]);\r\n  }\r\n\r\n  if (comboCounter >= 10 && comboCounter < 20) {\r\n    for (let i = 0; i < otherFoodArray.length - 1; i++) {\r\n      randomArray.push(otherFoodArray[i]);\r\n    }\r\n  }\r\n\r\n  if (comboCounter >= 20) {\r\n    for (let i = 0; i < otherFoodArray.length; i++) {\r\n      randomArray.push(otherFoodArray[i]);\r\n    }\r\n  }\r\n\r\n  return randomArray;\r\n};\r\n\r\nconst getDelayBaseOnDifficulty = (difficulty) => {\r\n  if (difficulty >= 1 && difficulty <= 3) {\r\n    return 2.5;\r\n  } else if (difficulty >= 4 && difficulty <= 6) {\r\n    return 2;\r\n  } else if (difficulty >= 7 && difficulty <= 9) {\r\n    return 1.5;\r\n  } else {\r\n    return 1;\r\n  }\r\n};\r\n\r\nconst getPattern = (number, width, height) => {\r\n  let timer;\r\n  let upSpeedX = [];\r\n  let upSpeedY;\r\n  let upAccelerationY;\r\n  let time;\r\n  let tmpSpeedX = [];\r\n  let tmpAccX = [];\r\n\r\n  if (number === 0) {\r\n    // 3 on 1 line\r\n    timer = [0, 0.15, 0.2];\r\n    upSpeedY = [height / 2];\r\n    upAccelerationY = -height / 4;\r\n    time = -upSpeedY / upAccelerationY;\r\n    if (Math.random() > 0.5) {\r\n      tmpSpeedX = [width / 3];\r\n    } else {\r\n      tmpSpeedX = [-width / 3];\r\n    }\r\n  } else if (number === 3) {\r\n    // 4 zig zag\r\n    timer = [0, 0.15, 0.17, 0.25];\r\n    upSpeedY = [height / 2];\r\n    upAccelerationY = -height / 4;\r\n    time = -upSpeedY / upAccelerationY;\r\n    if (Math.random() > 0.5) {\r\n      tmpSpeedX = [width / 3, width / 10, -width / 10, -width / 3];\r\n    } else {\r\n      tmpSpeedX = [-width / 3, -width / 10, width / 10, width / 3];\r\n    }\r\n  } else if (number === 4) {\r\n    // 5 V\r\n    timer = [0, 0.16, 0.16, 0.17, 0.17];\r\n    upSpeedY = [height / 2.1];\r\n    upAccelerationY = -height / 4;\r\n    time = -upSpeedY / upAccelerationY;\r\n    tmpSpeedX = [width / 100, width / 6, -width / 6, width / 2.5, -width / 2.5];\r\n  } else if (number === 5) {\r\n    // 5 V reverse\r\n    timer = [0, 0, 0.12, 0.12, 0.2];\r\n    upSpeedY = [height / 2.1];\r\n    upAccelerationY = -height / 4;\r\n    time = -upSpeedY / upAccelerationY;\r\n    tmpSpeedX = [width / 2.5, -width / 2.5, width / 6, -width / 6, width / 100];\r\n  } else if (number === 1) {\r\n    // 2 random index same time\r\n    timer = [0, 0.15];\r\n    upSpeedY = [height / 2];\r\n    upAccelerationY = -height / 4;\r\n    time = -upSpeedY / upAccelerationY;\r\n    if (Math.random() > 0.5) {\r\n      tmpSpeedX = [\r\n        Math.random() * (width / 4 - width / 8) + width / 8,\r\n        -(Math.random() * (width / 4 - width / 8) + width / 8),\r\n      ];\r\n    } else {\r\n      tmpSpeedX = [\r\n        -(Math.random() * (width / 4 - width / 8) + width / 8),\r\n        Math.random() * (width / 4 - width / 8) + width / 8,\r\n      ];\r\n    }\r\n  } else if (number === 2) {\r\n    // 3 random index same time\r\n    timer = [0, 0.2, 0.1];\r\n    upSpeedY = [height / 2];\r\n    upAccelerationY = -height / 4;\r\n    time = -upSpeedY / upAccelerationY;\r\n    tmpSpeedX = [\r\n      Math.random() * (width / 4 - width / 6) + width / 6,\r\n      -(Math.random() * (width / 2.8 - width / 5.5) + width / 5.5),\r\n      Math.random() * (width / 20 - width / 40) + width / 40,\r\n    ];\r\n  }\r\n\r\n  for (let i = 0; i < tmpSpeedX.length; i++) {\r\n    tmpAccX.push(-tmpSpeedX[i] / time);\r\n  }\r\n\r\n  for (let i = 0; i < tmpSpeedX.length; i++) {\r\n    upSpeedX.push({ speedX: tmpSpeedX[i], accerX: tmpAccX[i] });\r\n  }\r\n  return {\r\n    timer,\r\n    upSpeedX,\r\n    upSpeedY,\r\n    upAccelerationY,\r\n    time,\r\n  };\r\n};\r\n\r\nconst getShootTypeBaseOnDifficulty = (difficulty) => {\r\n  if (difficulty >= 1 && difficulty <= 2) {\r\n    return { minNumber: 0, maxNumber: 2 };\r\n  } else if (difficulty >= 3 && difficulty <= 7) {\r\n    return { minNumber: 0, maxNumber: 3 };\r\n  } else {\r\n    return { minNumber: 0, maxNumber: 5 };\r\n  }\r\n};\r\n\r\nconst createFoodSpawnSystem = () => {\r\n  let index = 0;\r\n  let delayAfterCombo = 2;\r\n  let pattern;\r\n  let timer;\r\n  let speedXIndex = 0;\r\n  let speedYIndex = 0;\r\n  return {\r\n    init(worldState, extra) {},\r\n\r\n    update(delta, worldState, { width, height }) {\r\n      // console.log(worldState.foods);\r\n      // console.log(worldState.stateTime, delayAfterCombo, timer);\r\n      const { foodTex, difficulty, recipes, comboCounter } = worldState;\r\n      if (pattern === undefined && worldState.stateTime > delayAfterCombo) {\r\n        const { minNumber, maxNumber } = getShootTypeBaseOnDifficulty(\r\n          difficulty\r\n        );\r\n        pattern = getPattern(\r\n          Math.round(Math.random() * (maxNumber - minNumber) + minNumber),\r\n          width,\r\n          height\r\n        );\r\n        // pattern = getPattern(5, width, height);\r\n\r\n        timer = worldState.stateTime + pattern.timer[index];\r\n      } else if (\r\n        worldState.stateTime > delayAfterCombo &&\r\n        worldState.stateTime > timer\r\n      ) {\r\n        index = Math.min((index += 1), pattern.timer.length);\r\n        timer = worldState.stateTime + pattern.timer[index];\r\n\r\n        let loop = 1;\r\n        let tmpIndex = index - 1;\r\n        while (true) {\r\n          if (\r\n            pattern.timer[tmpIndex] === pattern.timer[tmpIndex + 1] &&\r\n            tmpIndex < pattern.timer.length\r\n          ) {\r\n            tmpIndex = Math.min((tmpIndex += 1), pattern.timer.length);\r\n            loop += 1;\r\n          } else {\r\n            break;\r\n          }\r\n        }\r\n        // console.log(loop, index);\r\n        for (let i = 0; i < loop; i++) {\r\n          if (i > 0) {\r\n            index = Math.min((index += 1), pattern.timer.length);\r\n          }\r\n          timer = worldState.stateTime + pattern.timer[index];\r\n          const randomFoodArray = getRandomFoodList(\r\n            foodTex,\r\n            recipes,\r\n            comboCounter,\r\n            difficulty\r\n          );\r\n          shuffle(randomFoodArray);\r\n\r\n          worldState.foods.push({\r\n            stateTime: 0,\r\n            type: randomFoodArray[0],\r\n            x: width / 2,\r\n            y: (height * 2) / 3,\r\n            upTime: worldState.stateTime + pattern.time, // check with game stateTime\r\n            upRealTime: pattern.time,\r\n            oriSpeedX: pattern.upSpeedX[speedXIndex].speedX,\r\n            oriSpeedY: pattern.upSpeedY[speedYIndex],\r\n            upSpeedX: pattern.upSpeedX[speedXIndex].speedX,\r\n            upSpeedY: pattern.upSpeedY[speedYIndex],\r\n            upAccelerationX: pattern.upSpeedX[speedXIndex].accerX,\r\n            upAccelerationY: pattern.upAccelerationY,\r\n            downSpeedY: 0,\r\n            downAcceleration: height / 100,\r\n            scaleSpeed: (1 - 0) / pattern.time,\r\n            opacitySpeed: (1 - 0) / pattern.time,\r\n            oriScale: 0,\r\n            oriOpacity: 0,\r\n          });\r\n\r\n          speedXIndex = Math.min(\r\n            (speedXIndex += 1),\r\n            pattern.upSpeedX.length - 1\r\n          );\r\n          speedYIndex = Math.min(\r\n            (speedYIndex += 1),\r\n            pattern.upSpeedY.length - 1\r\n          );\r\n        }\r\n\r\n        // last\r\n        if (index === pattern.timer.length) {\r\n          delayAfterCombo =\r\n            worldState.stateTime + getDelayBaseOnDifficulty(difficulty);\r\n          index = 0;\r\n          speedXIndex = 0;\r\n          speedYIndex = 0;\r\n          pattern = undefined;\r\n        }\r\n      }\r\n    },\r\n  };\r\n};\r\n\r\nexport default createFoodSpawnSystem;\r\n"]},"metadata":{},"sourceType":"module"}